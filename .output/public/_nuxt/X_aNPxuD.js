import{f as V,c as h,o as _,a as s,_ as $,Z as q,s as B,p as A,q as H,b8 as J,g as W,z as f,R as C,t as S,h as b,av as z,b as L,i as O,bc as D,w as k,b9 as I,d as x,bm as R}from"./CxASCIl5.js";const U=V({__name:"EditComponentModalOpenButton",emits:["open"],setup(l,{emit:i}){const c=i;return(d,e)=>(_(),h("button",{class:"edit-icon-btn",onClick:e[0]||(e[0]=u=>c("open")),title:"Edit"},e[1]||(e[1]=[s("span",{class:"edit-icon-bg yellow-bg"},[s("svg",{width:"18",height:"18",viewBox:"0 0 20 20",fill:"none"},[s("circle",{cx:"10",cy:"10",r:"10",fill:"#facc15"}),s("path",{d:"M7.5 13.5L13.2 7.8C13.6 7.4 13.6 6.8 13.2 6.4L12.6 5.8C12.2 5.4 11.6 5.4 11.2 5.8L5.5 11.5V14.5H8.5L14.2 8.8C14.6 8.4 14.6 7.8 14.2 7.4L13.6 6.8C13.2 6.4 12.6 6.4 12.2 6.8L6.5 12.5",stroke:"#18181b","stroke-width":"1.2","stroke-linecap":"round"})])],-1)])))}}),ce=$(U,[["__scopeId","data-v-dad4683b"]]);function ie(l,i){function c(){document.querySelectorAll(".highlightable").forEach(e=>{e.classList.remove("highlighted-yellow","highlighted-selected","highlighted-dimmed")});const d=l.selectedElementIds;i.isHighlightMode&&document.querySelectorAll(".highlightable").forEach(e=>{const u=e.id;d.includes(u)?e.classList.add("highlighted-selected"):d.length>0?e.classList.add("highlighted-dimmed"):e.classList.add("highlighted-yellow")})}q(()=>l.selectedElementIds,c,{deep:!0}),q(()=>i.isHighlightMode,d=>{var e;l.isHighlightOn=d,d?c():(document.querySelectorAll(".highlightable").forEach(u=>{u.classList.remove("highlighted-selected","highlighted-dimmed","highlighted-yellow")}),(e=l.clearSelection)==null||e.call(l))}),B(()=>{c()})}const Z={key:0,class:"modal-overlay"},F={class:"modal"},G={class:"editor-container"},K={key:0,class:"editor-section"},P={class:"editor-label html-label"},X=["value"],Y={key:1,class:"editor-section"},ee={class:"editor-label sql-label"},te=["value"],oe={key:2,class:"editor-section"},le={class:"editor-label js-label"},se=["value"],ne={class:"modal-actions"},ae=V({__name:"EditComponentModal",props:{showEditor:{type:Boolean},draftHtmlTemplate:{},draftSqlQuery:{},draftJsCode:{},componentId:{}},emits:["update:showEditor"],setup(l,{emit:i}){const c=A(),d=H(),e=J(),u=c.systems.find(n=>n.id===d.selectedId)||null,{t:y}=W(),t=l,E=i,r=f(!0),m=f(t.draftHtmlTemplate),p=f(t.draftSqlQuery),v=f(t.draftJsCode);q(()=>t.showEditor,n=>{n&&(m.value=t.draftHtmlTemplate,p.value=t.draftSqlQuery,v.value=t.draftJsCode)});function T(n){var a,w;const o=((a=n.target)==null?void 0:a.value)||"";p.value=o,console.log("Current SQL Query:",o);try{if(u&&typeof((w=u.db)==null?void 0:w.validateSql)=="function"){console.log("Validating SQL: >",o,"<");const g=u.db.validateSql(o);r.value=g,console.log("SQL Valid:",g)}else r.value=!0,console.warn("selectedSystem or validateSql is not available")}catch(g){r.value=!0,console.error("Error validating SQL:",g)}}function Q(n){var a;const o=((a=n.target)==null?void 0:a.value)||"";m.value=o,console.log("Current HTML Template:",o)}function M(n){var a;const o=((a=n.target)==null?void 0:a.value)||"";v.value=o,console.log("Current JS Code:",o)}function N(n){console.log("Applying changes to: ",t.componentId),e.updateComponentCode(`${t.componentId}-html.vue`,m.value),e.updateComponentCode(`${t.componentId}-sql.vue`,p.value),e.updateComponentCode(`${t.componentId}-js.vue`,v.value),console.log("====== Changes applied ======"),console.log("NEW HTML Template:",e.getComponentCode(`${t.componentId}-html.vue`)),console.log("NEW SQL Query:",e.getComponentCode(`${t.componentId}-sql.vue`)),console.log("NEW JavaScript Code:",e.getComponentCode(`${t.componentId}-js.vue`)),I.setVariableValue(`${t.componentId}.vue`,"html",m.value),I.setVariableValue(`${t.componentId}.vue`,"sql",p.value),I.setVariableValue(`${t.componentId}.vue`,"js",v.value),E("update:showEditor",!1)}function j(){E("update:showEditor",!1)}return(n,o)=>{const a=O;return n.showEditor?(_(),h("div",Z,[s("div",F,[s("div",G,[m.value?(_(),h("div",K,[s("h3",P,S(b(y)("html_template")),1),s("textarea",{value:m.value,onInput:Q,class:"code-editor html-editor",spellcheck:"false"},null,40,X)])):C("",!0),p.value?(_(),h("div",Y,[s("h3",ee,S(b(y)("sql_query")),1),s("textarea",{value:p.value,onInput:T,class:z(["code-editor sql-editor",{"invalid-sql":!r.value}]),spellcheck:"false"},null,42,te)])):C("",!0),v.value?(_(),h("div",oe,[s("h3",le,S(b(y)("js_code")),1),s("textarea",{value:v.value,onInput:M,class:"code-editor js-editor",spellcheck:"false"},null,40,se)])):C("",!0)]),s("div",ne,[L(a,{onClick:N,disabled:!r.value,style:D({backgroundColor:r.value?"#3b82f6":"#ef4444",color:"white"})},{default:k(()=>o[0]||(o[0]=[x(" Apply ")])),_:1,__:[0]},8,["disabled","style"]),L(a,{onClick:j,class:"bg-gray-500 text-white px-4 py-2 rounded"},{default:k(()=>o[1]||(o[1]=[x(" Close ")])),_:1,__:[1]})])])])):C("",!0)}}}),ue=$(ae,[["__scopeId","data-v-c51a983c"]]),re=R("selectedTable",()=>{const l=f(null);function i(d){l.value=d}function c(){l.value=null}return{selectedTableName:l,select:i,clear:c}});export{ue as _,ce as a,re as b,ie as u};
