import{f as E,c as m,o as v,a as o,_ as L,v as j,x as B,al as J,g as M,C as _,ae as z,S,t as g,h as b,U as A,b as w,i as W,az as U,w as x,am as I,d as V,b0 as D}from"./j0WNL21o.js";const O=E({__name:"EditComponentModalOpenButton",emits:["open"],setup(n,{emit:u}){const p=u;return(f,s)=>(v(),m("button",{class:"edit-icon-btn",onClick:s[0]||(s[0]=C=>p("open")),title:"Edit"},s[1]||(s[1]=[o("span",{class:"edit-icon-bg yellow-bg"},[o("svg",{width:"18",height:"18",viewBox:"0 0 20 20",fill:"none"},[o("circle",{cx:"10",cy:"10",r:"10",fill:"#facc15"}),o("path",{d:"M7.5 13.5L13.2 7.8C13.6 7.4 13.6 6.8 13.2 6.4L12.6 5.8C12.2 5.4 11.6 5.4 11.2 5.8L5.5 11.5V14.5H8.5L14.2 8.8C14.6 8.4 14.6 7.8 14.2 7.4L13.6 6.8C13.2 6.4 12.6 6.4 12.2 6.8L6.5 12.5",stroke:"#18181b","stroke-width":"1.2","stroke-linecap":"round"})])],-1)])))}}),de=L(O,[["__scopeId","data-v-dad4683b"]]),F={key:0,class:"modal-overlay"},G={class:"modal"},K={class:"editor-container"},P={key:0,class:"editor-section"},R={class:"editor-label html-label"},X=["value"],Y={key:1,class:"editor-section"},Z={class:"editor-label sql-label"},ee=["value"],te={key:2,class:"editor-section"},oe={class:"editor-label js-label"},le=["value"],se={class:"modal-actions"},ae=E({__name:"EditComponentModal",props:{showEditor:{type:Boolean},draftHtmlTemplate:{},draftSqlQuery:{},draftJsCode:{},componentId:{}},emits:["update:showEditor"],setup(n,{emit:u}){const p=j(),f=B(),s=J(),C=p.systems.find(l=>l.id===f.selectedId)||null,{t:y}=M(),e=n,q=u,d=_(!0),c=_(e.draftHtmlTemplate),r=_(e.draftSqlQuery),i=_(e.draftJsCode);z(()=>e.showEditor,l=>{l&&(c.value=e.draftHtmlTemplate,r.value=e.draftSqlQuery,i.value=e.draftJsCode)});function $(l){var a,k;const t=((a=l.target)==null?void 0:a.value)||"";r.value=t,console.log("Current SQL Query:",t);try{if(C&&typeof((k=C.db)==null?void 0:k.validateSql)=="function"){console.log("Validating SQL: >",t,"<");const h=C.db.validateSql(t);d.value=h,console.log("SQL Valid:",h)}else d.value=!0,console.warn("selectedSystem or validateSql is not available")}catch(h){d.value=!0,console.error("Error validating SQL:",h)}}function T(l){var a;const t=((a=l.target)==null?void 0:a.value)||"";c.value=t,console.log("Current HTML Template:",t)}function Q(l){var a;const t=((a=l.target)==null?void 0:a.value)||"";i.value=t,console.log("Current JS Code:",t)}function H(l){console.log("Applying changes to: ",e.componentId),s.updateComponentCode(`${e.componentId}-html.vue`,c.value),s.updateComponentCode(`${e.componentId}-sql.vue`,r.value),s.updateComponentCode(`${e.componentId}-js.vue`,i.value),console.log("====== Changes applied ======"),console.log("NEW HTML Template:",s.getComponentCode(`${e.componentId}-html.vue`)),console.log("NEW SQL Query:",s.getComponentCode(`${e.componentId}-sql.vue`)),console.log("NEW JavaScript Code:",s.getComponentCode(`${e.componentId}-js.vue`)),I.setVariableValue(`${e.componentId}.vue`,"html",c.value),I.setVariableValue(`${e.componentId}.vue`,"sql",r.value),I.setVariableValue(`${e.componentId}.vue`,"js",i.value),q("update:showEditor",!1)}function N(){q("update:showEditor",!1)}return(l,t)=>{const a=W;return l.showEditor?(v(),m("div",F,[o("div",G,[o("div",K,[c.value?(v(),m("div",P,[o("h3",R,g(b(y)("html_template")),1),o("textarea",{value:c.value,onInput:T,class:"code-editor html-editor",spellcheck:"false"},null,40,X)])):S("",!0),r.value?(v(),m("div",Y,[o("h3",Z,g(b(y)("sql_query")),1),o("textarea",{value:r.value,onInput:$,class:A(["code-editor sql-editor",{"invalid-sql":!d.value}]),spellcheck:"false"},null,42,ee)])):S("",!0),i.value?(v(),m("div",te,[o("h3",oe,g(b(y)("js_code")),1),o("textarea",{value:i.value,onInput:Q,class:"code-editor js-editor",spellcheck:"false"},null,40,le)])):S("",!0)]),o("div",se,[w(a,{onClick:H,disabled:!d.value,style:U({backgroundColor:d.value?"#3b82f6":"#ef4444",color:"white"})},{default:x(()=>t[0]||(t[0]=[V(" Apply ")])),_:1,__:[0]},8,["disabled","style"]),w(a,{onClick:N,class:"bg-gray-500 text-white px-4 py-2 rounded"},{default:x(()=>t[1]||(t[1]=[V(" Close ")])),_:1,__:[1]})])])])):S("",!0)}}}),ce=L(ae,[["__scopeId","data-v-c51a983c"]]),re=D("selectedTable",()=>{const n=_(null);function u(f){n.value=f}function p(){n.value=null}return{selectedTableName:n,select:u,clear:p}},{persist:!0});export{ce as _,de as a,re as u};
