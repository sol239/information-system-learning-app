import{_ as oe}from"./Djub6ojE.js";import{h as ne,g as ie}from"./CHNo5zRk.js";import{f as re,x as de,g as ue,ab as ce,C as h,m as $,ae as q,ac as me,z as pe,c as U,b as a,a as s,S as B,h as n,t as i,w as m,F as ve,r as ge,ah as fe,i as ye,o as D,T as be,d as x,j as he,ag as xe,_ as ke}from"./j0WNL21o.js";import{_ as _e,a as Ve}from"./DJVxr4fb.js";import{P as Se}from"./z1NFFN3t.js";import{S as $e}from"./B_2Y0efC.js";import{u as Ce}from"./CEer_hvB.js";const Ee={class:"container mx-auto px-4 py-8"},we={class:"flex items-center gap-4 mb-6"},Ie={key:0,class:"flex items-center gap-2 px-3 py-2 bg-gray-100 rounded-lg"},Ue={class:"ml-auto"},De={class:"text-lg font-semibold"},Me={class:"flex flex-col gap-3 pt-4"},Pe={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},Oe=["id","onClick"],Re={class:"participant-header"},Te={class:"flex items-center justify-between mb-4"},He={class:"text-xl font-semibold text-gray-900"},Ne={class:"flex items-center gap-2 text-base font-semibold text-gray-700"},je={class:"turnus-section mb-4"},Ae={class:"text-sm text-gray-600"},Fe={class:"contact-section mb-6 space-y-2"},Le={class:"flex items-center gap-2 text-sm font-semibold text-gray-700"},qe={class:"flex items-center gap-2 text-sm font-semibold text-gray-700"},Be={class:"participant-actions mt-6 pt-4 border-t border-gray-200"},ze={class:"flex gap-2"},Je={class:"ml-auto"},We={class:"text-lg font-semibold"},Ye={class:"flex flex-col gap-3 pt-4"},Ze={key:0,class:"flex justify-center items-center gap-4 mt-8"},Qe={class:"flex items-center gap-2"},Ge={key:1,class:"empty-state"},Ke={class:"empty-title"},Xe={class:"empty-description"},el=re({__name:"participants",setup(ll){const g=de(),{t:o}=ue(),y=ce(),Z=h([{label:o("dashboard"),icon:"i-heroicons-chart-bar-20-solid",to:`/system/${g.selectedId}/dashboard`,data_target:"system-dashboard"},{label:o("sessions"),icon:"i-heroicons-calendar-date-range",to:`/system/${g.selectedId}/sessions`,data_target:"system-sessions"},{label:o("participants"),to:`/system/${g.selectedId}/participants`,data_target:"system-participants"},{label:o("supervisors"),to:`/system/${g.selectedId}/supervisors`,data_target:"system-supervisors"},{label:o("database"),icon:"i-heroicons-table-cells",to:`/system/${g.selectedId}/database`,data_target:"system-table"}]),k=h({label:o("all_sessions"),value:"all"}),M=h([]),C=h([]);h(!1);const u=h(null);h("all");const E=h(!1),_=h(!1),O=h(!1);Ce(y.highlightHandler,y);const p=h({name:"",email:"",personal_number:"",phone:"",address:"",age:null,sessionId:null,allergens:[]}),z=[{label:"Mléko",value:"Mléko"},{label:"Skořápkové plody",value:"Skořápkové plody"},{label:"Lepek",value:"Lepek"},{label:"Vejce",value:"Vejce"},{label:"Ryby",value:"Ryby"},{label:"Sója",value:"Sója"},{label:"Arašídy",value:"Arašídy"},{label:"Celer",value:"Celer"},{label:"Hořčice",value:"Hořčice"},{label:"Sezam",value:"Sezam"},{label:"Oxid siřičitý",value:"Oxid siřičitý"},{label:"Lupina",value:"Lupina"},{label:"Měkkýši",value:"Měkkýši"}],J=$(()=>C.value.map(l=>({label:`${o("session")} ${l.id} (${F(l.fromDate,l.toDate)})`,value:l.id}))),V=h(1),j=h(6),A=$(()=>Math.ceil(R.value.length/j.value)),Q=$(()=>{const l=(V.value-1)*j.value,e=l+j.value;return R.value.slice(l,e)});q(()=>k.value.value,()=>{V.value=1});const G=$(()=>[{label:o("all_sessions"),value:"all"},...C.value.map(l=>({label:F(l.fromDate,l.toDate),value:l.id}))]),R=$(()=>k.value.value==="all"?M.value:M.value.filter(l=>l.sessionId===k.value.value)),S=me(),P=$(()=>{if(k.value.value==="all"){const r=C.value.reduce((f,v)=>f+v.capacity,0),d=M.value.length,b=r>0?d/r*100:0;return{currentCount:d,totalCapacity:r,fillPercentage:b,isFull:d>=r,isNearFull:b>=80}}const l=C.value.find(r=>r.id===k.value.value);if(!l)return null;const e=M.value.filter(r=>r.sessionId===l.id).length,c=e/l.capacity*100;return{currentCount:e,totalCapacity:l.capacity,fillPercentage:c,isFull:e>=l.capacity,isNearFull:c>=80}}),K=$(()=>{var l,e,c,r,d;if(!((l=g.selectedSystem)!=null&&l.db))return"";try{const b=g.selectedSystem.db.query("SELECT COUNT(*) as count FROM účastníci"),f=((c=(e=b==null?void 0:b.results)==null?void 0:e[0])==null?void 0:c.count)||0,v=g.selectedSystem.db.query("SELECT COUNT(*) as count FROM turnusy"),H=((d=(r=v==null?void 0:v.results)==null?void 0:r[0])==null?void 0:d.count)||0,I=g.selectedSystem.db.query("SELECT id, jméno, email FROM účastníci ORDER BY id DESC LIMIT 3"),N=JSON.stringify((I==null?void 0:I.results)||[]);return`p${f}-s${H}-${N.length}-${Date.now()}`}catch{return`error-${Date.now()}`}});q(K,(l,e)=>{e&&l!==e&&!l.startsWith("error")&&(console.log("Database changes detected via hash, reloading data..."),w())});const w=()=>{var l;if(!((l=g.selectedSystem)!=null&&l.db)){console.error("Database not available");return}try{const e=g.selectedSystem.db.query("SELECT * FROM účastníci ORDER BY id").results||[],c=[];for(const d of e)c.push(Se.fromDbRow(d));M.value=c;const r=g.selectedSystem.db.query("SELECT * FROM turnusy ORDER BY id");r.success&&(C.value=r.results.map(d=>new $e(d.id,new Date(d.od),new Date(d.do),d.kapacita,[])))}catch(e){console.error("Error loading data from database:",e)}};q(()=>g.selectedSystem,l=>{l&&w()},{immediate:!0});const X=l=>{const e=C.value.find(c=>c.id===l);return e?`${o("session")} ${e.id} (${F(e.fromDate,e.toDate)})`:o("unknown_session")},F=(l,e)=>{const c=l.toLocaleDateString("cs-CZ",{day:"numeric",month:"short"}),r=e.toLocaleDateString("cs-CZ",{day:"numeric",month:"short",year:"numeric"});return`${c} - ${r}`};async function ee(l){console.log("Participant: ",l),u.value=l,_.value=!0,console.log("FINISHED")}const W=()=>{y.isHighlightMode||(T(),O.value=!0)},le=async l=>{var e;if(!((e=g.selectedSystem)!=null&&e.db)){console.error("Database not available");return}E.value=!0;try{const c=typeof l.sessionId=="object"?l.sessionId.value:l.sessionId,r=Array.isArray(l.allergens)?l.allergens:[],d=JSON.stringify(r),b=`
            INSERT INTO účastníci (jméno, email, rodné_číslo, telefon, adresa, věk, turnus_id, alergeny)
            VALUES ('${l.name}', '${l.email}', '${l.personal_number}', '${l.phone}', '${l.address}', ${l.age}, ${c}, '${d}')
        `;if(g.selectedSystem.db.query(b).success)S.add({title:o("participant_added_success",{name:l.name}),color:"primary",icon:"i-heroicons-check"}),T(),w();else throw new Error("Database insert failed")}catch(c){console.error("Error adding participant:",c),S.add({title:o("participant_add_error"),color:"red",icon:"i-heroicons-exclamation-triangle"})}finally{E.value=!1}},T=()=>{p.value={name:"",email:"",personal_number:"",phone:"",address:"",age:null,sessionId:null,allergens:[]},O.value=!1,_.value=!1},te=async l=>{var e;if(!((e=g.selectedSystem)!=null&&e.db)||!u.value){console.error("Database not available or no participant selected");return}E.value=!0;try{const c=typeof l.sessionId=="object"?l.sessionId.value:l.sessionId,r=Array.isArray(l.allergens)?l.allergens.map(v=>v.value||v):[],d=JSON.stringify(r);console.log("Updating participant:",u.value.id);const b=`
            UPDATE účastníci 
            SET jméno = '${l.name}', email = '${l.email}', rodné_číslo = '${l.personal_number}', 
                telefon = '${l.phone}', adresa = '${l.address}', věk = ${l.age}, alergeny = '${d}', turnus_id = ${c}
            WHERE id = '${u.value.id}'
        `;console.log("QUERY: ",b),g.selectedSystem.db.query(b).success?(S.add({title:o("participant_updated_success",{name:l.name}),color:"primary",icon:"i-heroicons-check"}),w(),_.value=!1):(S.add({title:o("participant_update_error"),color:"red",icon:"i-heroicons-exclamation-triangle"}),_.value=!1)}catch(c){console.log("Error updating participant:",c),S.add({title:o("participant_update_error"),color:"red",icon:"i-heroicons-exclamation-triangle"}),_.value=!1}finally{E.value=!1}},se=l=>{var e;console.log("Removing participant:",l.id);try{(e=g.selectedSystem)==null||e.db.query(`DELETE FROM účastníci WHERE id = ${l.id}`),w(),S.add({title:o("participant_deleted_success",{name:l.name}),color:"primary",icon:"i-lucide-trash-2"})}catch{console.error("Error deleting participant:",l.id),S.add({title:o("participant_delete_error",{name:l.name}),color:"red",icon:"i-lucide-alert-triangle"})}},ae=l=>l>=90?"red":l>=70?"yellow":"green";return pe(()=>{w()}),(l,e)=>{const c=oe,r=ne,d=be,b=fe,f=ye,v=xe,H=Ve,I=ie,N=he,Y=_e;return D(),U("div",null,[a(c,{items:Z.value},null,8,["items"]),s("div",Ee,[s("div",we,[a(r,{class:"highlightable",id:"participants-session-menu",onClick:e[0]||(e[0]=t=>n(y).isHighlightMode&&n(y).highlightHandler.selectElement("participants-session-menu",t)),modelValue:k.value,"onUpdate:modelValue":e[1]||(e[1]=t=>k.value=t),items:G.value},null,8,["modelValue","items"]),P.value?(D(),U("div",Ie,[a(d,{name:"i-heroicons-users",class:"w-4 h-4 text-gray-600"}),s("span",{class:"text-sm font-medium text-gray-700 highlightable",id:"participants-capacity-count",onClick:e[2]||(e[2]=t=>n(y).isHighlightMode&&n(y).highlightHandler.selectElement("participants-capacity-count",t))},i(n(o)("capacity"))+": "+i(P.value.currentCount)+"/"+i(P.value.totalCapacity),1),a(b,{class:"highlightable",id:"participants-capacity-percentage",onClick:e[3]||(e[3]=t=>n(y).isHighlightMode&&n(y).highlightHandler.selectElement("participants-capacity-percentage",t)),color:ae(P.value.fillPercentage),variant:"soft",size:"sm"},{default:m(()=>[x(i(Math.round(P.value.fillPercentage))+"% ",1)]),_:1},8,["color"])])):B("",!0),s("div",Ue,[a(Y,{open:O.value,"onUpdate:open":e[13]||(e[13]=t=>O.value=t),direction:"right"},{content:m(()=>[a(N,{class:"p-4 min-w-96"},{header:m(()=>[s("h3",De,i(n(o)("add_participant")),1)]),default:m(()=>[a(I,{state:p.value,onSubmit:e[12]||(e[12]=t=>le(p.value)),class:"flex flex-col space-y-4"},{default:m(()=>[s("div",null,[e[28]||(e[28]=s("label",{for:"name",class:"block text-sm font-medium text-white mb-1"},"Jméno",-1)),a(v,{color:"sky",id:"name",modelValue:p.value.name,"onUpdate:modelValue":e[4]||(e[4]=t=>p.value.name=t),placeholder:"Zadejte jméno účastníka"},null,8,["modelValue"])]),s("div",null,[e[29]||(e[29]=s("label",{for:"email",class:"block text-sm font-medium text-white mb-1"},"E-mail",-1)),a(v,{color:"sky",id:"email",modelValue:p.value.email,"onUpdate:modelValue":e[5]||(e[5]=t=>p.value.email=t),type:"email",placeholder:"email@example.com"},null,8,["modelValue"])]),s("div",null,[e[30]||(e[30]=s("label",{for:"personal_number",class:"block text-sm font-medium text-white mb-1"},"Rodné číslo",-1)),a(v,{color:"sky",id:"personal_number",modelValue:p.value.personal_number,"onUpdate:modelValue":e[6]||(e[6]=t=>p.value.personal_number=t),placeholder:"123456/7890"},null,8,["modelValue"])]),s("div",null,[e[31]||(e[31]=s("label",{for:"phone",class:"block text-sm font-medium text-white mb-1"},"Telefon",-1)),a(v,{color:"sky",id:"phone",modelValue:p.value.phone,"onUpdate:modelValue":e[7]||(e[7]=t=>p.value.phone=t),placeholder:"+420 123 456 789"},null,8,["modelValue"])]),s("div",null,[e[32]||(e[32]=s("label",{for:"address",class:"block text-sm font-medium text-white mb-1"},"Adresa",-1)),a(H,{color:"sky",id:"address",modelValue:p.value.address,"onUpdate:modelValue":e[8]||(e[8]=t=>p.value.address=t),placeholder:"Ulice číslo, město, PSČ",rows:2},null,8,["modelValue"])]),s("div",null,[e[33]||(e[33]=s("label",{for:"age",class:"block text-sm font-medium text-white mb-1"},"Věk",-1)),a(v,{color:"sky",id:"age",modelValue:p.value.age,"onUpdate:modelValue":e[9]||(e[9]=t=>p.value.age=t),type:"number",min:"1",max:"100",placeholder:"18"},null,8,["modelValue"])]),s("div",null,[e[34]||(e[34]=s("label",{for:"sessionId",class:"block text-sm font-medium text-white mb-1"},"Turnus",-1)),a(r,{color:"sky",id:"sessionId",modelValue:p.value.sessionId,"onUpdate:modelValue":e[10]||(e[10]=t=>p.value.sessionId=t),items:J.value,placeholder:"Vyberte turnus"},null,8,["modelValue","items"])]),s("div",null,[e[35]||(e[35]=s("label",{for:"allergens",class:"block text-sm font-medium text-white mb-1"},"Alergeny",-1)),a(r,{color:"sky",id:"allergens",modelValue:p.value.allergens,"onUpdate:modelValue":e[11]||(e[11]=t=>p.value.allergens=t),items:z,multiple:!0,placeholder:"Vyberte alergeny"},null,8,["modelValue"]),e[36]||(e[36]=s("small",{class:"text-xs text-gray-400"},"Můžete vybrat více možností",-1))]),s("div",Me,[a(f,{type:"submit",color:"sky",loading:E.value},{default:m(()=>[x(i(n(o)("add")),1)]),_:1},8,["loading"]),a(f,{variant:"outline",color:"sky",onClick:T},{default:m(()=>[x(i(n(o)("cancel")),1)]),_:1})])]),_:1},8,["state"])]),_:1})]),default:m(()=>[a(f,{color:"sky",variant:"outline",onClick:W,icon:"i-heroicons-plus"},{default:m(()=>[x(i(n(o)("add_participant")),1)]),_:1})]),_:1},8,["open"])])]),s("div",Pe,[(D(!0),U(ve,null,ge(Q.value,t=>(D(),U("div",{key:t.id,class:"participant-card highlightable",id:"participants-card-"+t.id,onClick:L=>n(y).isHighlightMode&&n(y).highlightHandler.selectElement("participants-card-"+t.id,L)},[s("div",Re,[s("div",Te,[s("h3",He,i(t.name),1),a(b,{size:"lg",color:"sky",variant:"soft"},{default:m(()=>[x(i(n(o)("age"))+": "+i(t.age),1)]),_:2},1024)]),s("div",Ne,[a(d,{name:"i-heroicons-envelope",class:"w-4 h-4"}),s("span",null,i(t.email),1)])]),s("div",je,[s("span",Ae,i(X(t.sessionId)),1)]),s("div",Fe,[s("div",Le,[a(d,{name:"i-heroicons-phone",class:"w-4 h-4"}),s("span",null,i(t.phone),1)]),s("div",qe,[a(d,{name:"i-heroicons-map-pin",class:"w-4 h-4"}),s("span",null,i(t.address),1)])]),s("div",Be,[s("div",ze,[s("div",Je,[a(f,{size:"sm",color:"sky",variant:"solid",onClick:L=>ee(t),class:"flex-1"},{default:m(()=>[x(i(n(o)("view_details")),1)]),_:2},1032,["onClick"])]),a(f,{size:"sm",color:"red",variant:"outline",onClick:L=>se(t)},{default:m(()=>[x(i(n(o)("delete")),1)]),_:2},1032,["onClick"])])])],8,Oe))),128))]),a(Y,{class:"ml-auto",open:_.value,"onUpdate:open":e[23]||(e[23]=t=>_.value=t),direction:"right"},{content:m(()=>[a(N,{class:"p-4 min-w-96"},{header:m(()=>[s("h3",We,i(n(o)("participant_details")),1)]),default:m(()=>[a(I,{state:u.value,onSubmit:e[22]||(e[22]=t=>te(u.value)),class:"flex flex-col space-y-4"},{default:m(()=>[s("div",null,[e[37]||(e[37]=s("label",{for:"edit-name",class:"block text-sm font-medium text-white mb-1"},"Jméno",-1)),a(v,{color:"sky",id:"edit-name",modelValue:u.value.name,"onUpdate:modelValue":e[14]||(e[14]=t=>u.value.name=t),placeholder:"Zadejte jméno účastníka"},null,8,["modelValue"])]),s("div",null,[e[38]||(e[38]=s("label",{for:"edit-email",class:"block text-sm font-medium text-white mb-1"},"E-mail",-1)),a(v,{color:"sky",id:"edit-email",modelValue:u.value.email,"onUpdate:modelValue":e[15]||(e[15]=t=>u.value.email=t),type:"email",placeholder:"email@example.com"},null,8,["modelValue"])]),s("div",null,[e[39]||(e[39]=s("label",{for:"edit-personal_number",class:"block text-sm font-medium text-white mb-1"},"Rodné číslo",-1)),a(v,{color:"sky",id:"edit-personal_number",modelValue:u.value.personal_number,"onUpdate:modelValue":e[16]||(e[16]=t=>u.value.personal_number=t),placeholder:"123456/7890"},null,8,["modelValue"])]),s("div",null,[e[40]||(e[40]=s("label",{for:"edit-phone",class:"block text-sm font-medium text-white mb-1"},"Telefon",-1)),a(v,{color:"sky",id:"edit-phone",modelValue:u.value.phone,"onUpdate:modelValue":e[17]||(e[17]=t=>u.value.phone=t),placeholder:"+420 123 456 789"},null,8,["modelValue"])]),s("div",null,[e[41]||(e[41]=s("label",{for:"edit-address",class:"block text-sm font-medium text-white mb-1"},"Adresa",-1)),a(H,{color:"sky",id:"edit-address",modelValue:u.value.address,"onUpdate:modelValue":e[18]||(e[18]=t=>u.value.address=t),placeholder:"Ulice číslo, město, PSČ",rows:2},null,8,["modelValue"])]),s("div",null,[e[42]||(e[42]=s("label",{for:"edit-age",class:"block text-sm font-medium text-white mb-1"},"Věk",-1)),a(v,{color:"sky",id:"edit-age",modelValue:u.value.age,"onUpdate:modelValue":e[19]||(e[19]=t=>u.value.age=t),type:"number",min:"1",max:"100",placeholder:"18"},null,8,["modelValue"])]),s("div",null,[e[43]||(e[43]=s("label",{for:"edit-sessionId",class:"block text-sm font-medium text-white mb-1"},"Turnus",-1)),a(r,{color:"sky",id:"edit-sessionId",modelValue:u.value.sessionId,"onUpdate:modelValue":e[20]||(e[20]=t=>u.value.sessionId=t),items:J.value,placeholder:"Vyberte turnus"},null,8,["modelValue","items"])]),s("div",null,[e[44]||(e[44]=s("label",{for:"edit-allergens",class:"block text-sm font-medium text-white mb-1"},"Alergeny",-1)),a(r,{color:"sky",id:"edit-allergens",modelValue:u.value.allergens,"onUpdate:modelValue":e[21]||(e[21]=t=>u.value.allergens=t),items:z,multiple:!0,placeholder:"Vyberte alergeny"},null,8,["modelValue"]),e[45]||(e[45]=s("small",{class:"text-xs text-gray-400"},"Můžete vybrat více možností",-1))]),s("div",Ye,[a(f,{type:"submit",color:"sky",loading:E.value},{default:m(()=>[x(i(n(o)("save_changes")),1)]),_:1},8,["loading"]),a(f,{variant:"outline",color:"sky",onClick:T},{default:m(()=>[x(i(n(o)("cancel")),1)]),_:1})])]),_:1},8,["state"])]),_:1})]),_:1},8,["open"]),A.value>1?(D(),U("div",Ze,[a(f,{variant:"outline",color:"sky",icon:"i-heroicons-chevron-left",disabled:V.value===1,onClick:e[24]||(e[24]=t=>V.value--)},{default:m(()=>[x(i(n(o)("previous")),1)]),_:1},8,["disabled"]),s("div",Qe,[s("span",{class:"text-sm text-gray-600 highlightable",id:"participants-page-count-1",onClick:e[25]||(e[25]=t=>n(y).isHighlightMode&&n(y).highlightHandler.selectElement("participants-page-count-1",t))},i(n(o)("page"))+" "+i(V.value)+" "+i(n(o)("of"))+" "+i(A.value),1),s("span",{class:"text-xs text-gray-500 highlightable",id:"participants-page-count-2",onClick:e[26]||(e[26]=t=>n(y).isHighlightMode&&n(y).highlightHandler.selectElement("participants-page-count-2",t))}," ("+i(R.value.length)+" "+i(n(o)("participants"))+") ",1)]),a(f,{variant:"outline",color:"sky",icon:"i-heroicons-chevron-right",disabled:V.value===A.value,onClick:e[27]||(e[27]=t=>V.value++)},{default:m(()=>[x(i(n(o)("next")),1)]),_:1},8,["disabled"])])):B("",!0),R.value.length===0?(D(),U("div",Ge,[a(d,{name:"i-heroicons-user-x-mark",class:"empty-icon"}),s("h3",Ke,i(n(o)("no_participants")),1),s("p",Xe,i(n(o)("no_participants_description")),1),a(f,{onClick:W,class:"mt-4"},{default:m(()=>[x(i(n(o)("create_participant")),1)]),_:1})])):B("",!0)])])}}}),dl=ke(el,[["__scopeId","data-v-c85142b8"]]);export{dl as default};
