import{_ as ee}from"./DIZ2Gwrj.js";import{f as O,q as J,aL as D,bj as A,b8 as N,g as x,z as d,l as t,c as Q,a as u,x as j,R as B,h as M,n as U,o as E,b9 as h,bk as te,_ as R,p as Y,s as K,t as F,b as V,bh as se,F as oe,v as ne,bc as ae,bl as re,y as le,w as ie,j as ue}from"./CxASCIl5.js";import{b as z,a as G,u as X,_ as ce}from"./X_aNPxuD.js";const de={class:"stat-card-wrapper"},pe=["innerHTML"],me=O({__name:"stats-sessions",props:{system:{}},emits:["openModal","applyChanges"],setup(k,{expose:w,emit:S}){const g=J(),p=z(),m=D(),c=A(),T=N(),{t:C}=x(),I=k,H=S;d(!1);const v=d(""),_=d("");function f(l){return te.getNotCompletedTasks(c.currentRound).some(W=>Array.isArray(W.errorComponents)&&W.errorComponents.some(Z=>Z.name===l))}const y=t(()=>T.getComponentCode("stats-sessions-sql.vue")),o=t(()=>T.getComponentCode("stats-sessions-html.vue")),s=t(()=>T.getComponentCode("stats-sessions-js.vue")),a=t(()=>{if(f("stats-sessions.vue")){const l=h.getVariableValue("stats-sessions.vue","sql")||y.value;return T.updateComponentCode("stats-sessions-sql.vue",l),l}return y.value}),b=t(()=>{if(f("stats-sessions.vue")){const l=h.getVariableValue("stats-sessions.vue","html")||o.value;return T.updateComponentCode("stats-sessions-html.vue",l),l}return o.value}),r=t(()=>{if(h.isInErrorComponents("stats-sessions.vue")){const l=h.getVariableValue("stats-sessions.vue","js")||s.value;return T.updateComponentCode("stats-sessions-js.vue",l),l}return s.value}),n=t(()=>{var P,L;const l=(P=I.system)==null?void 0:P.db.query(a.value).results;return((L=l==null?void 0:l[0])==null?void 0:L.count)||0}),i=t(()=>b.value.replace("{{ sessionsCount }}",String(n.value)).replace("{{ label }}",C("sessions")));function q(){v.value=a.value,_.value=b.value,H("openModal",{componentId:"stats-sessions",htmlTemplate:_.value,sqlQuery:v.value})}function e(l){v.value=l.sqlQuery,_.value=l.htmlTemplate}function $(){if(m.isHighlightMode)return;new Function("selectedTableStore","navigateTo","systemId",r.value)(p,U,g.selectedId)}return w({applyChanges:e}),(l,P)=>{const L=G;return E(),Q("div",null,[u("div",de,[u("div",{id:"stats-sessions",onClick:$,class:"cursor-pointer",innerHTML:i.value},null,8,pe),M(m).isEditModeActive?(E(),j(L,{key:0,onOpen:q})):B("",!0)])])}}}),ve=R(me,[["__scopeId","data-v-e1782825"]]),he={class:"stat-card-wrapper"},ge=["innerHTML"],_e=O({__name:"stats-participants",props:{system:{}},emits:["openModal","applyChanges"],setup(k,{expose:w,emit:S}){const g=J(),p=z(),m=D();A();const c=N(),{t:T}=x(),C=k,I=S;d(!1);const H=d(""),v=d(""),_=t(()=>c.getComponentCode("stats-participants-sql.vue")),f=t(()=>c.getComponentCode("stats-participants-html.vue")),y=t(()=>c.getComponentCode("stats-participants-js.vue")),o=t(()=>{if(h.isInErrorComponents("stats-participants.vue")){const e=h.getVariableValue("stats-participants.vue","sql")||_.value;return c.updateComponentCode("stats-participants-sql.vue",e),e}return _.value}),s=t(()=>{if(h.isInErrorComponents("stats-participants.vue")){const e=h.getVariableValue("stats-participants.vue","html")||f.value;return c.updateComponentCode("stats-participants-html.vue",e),e}return f.value}),a=t(()=>{if(h.isInErrorComponents("stats-participants.vue")){const e=h.getVariableValue("stats-participants.vue","js")||y.value;return c.updateComponentCode("stats-participants-js.vue",e),e}return y.value}),b=t(()=>{var $,l;const e=($=C.system)==null?void 0:$.db.query(o.value).results;return((l=e==null?void 0:e[0])==null?void 0:l.count)||0}),r=t(()=>s.value.replace("{{ participantsCount }}",String(b.value)).replace("{{ label }}",T("participants")));function n(){H.value=o.value,v.value=s.value,I("openModal",{componentId:"stats-participants",htmlTemplate:v.value,sqlQuery:H.value})}function i(e){H.value=e.sqlQuery,v.value=e.htmlTemplate}function q(){if(m.isHighlightMode)return;new Function("selectedTableStore","navigateTo","systemId",a.value)(p,U,g.selectedId)}return w({applyChanges:i}),(e,$)=>{const l=G;return E(),Q("div",null,[u("div",he,[u("div",{id:"stats-participants",onClick:q,class:"cursor-pointer",innerHTML:r.value},null,8,ge),M(m).isEditModeActive?(E(),j(l,{key:0,onOpen:n})):B("",!0)])])}}}),Ce=R(_e,[["__scopeId","data-v-09257eed"]]),fe={class:"stat-card-wrapper"},ye=["innerHTML"],be=O({__name:"stats-supervisors",props:{system:{}},emits:["openModal","applyChanges"],setup(k,{emit:w}){const S=J(),g=z(),p=D();A();const m=N(),{t:c}=x(),T=k,C=w;d(!1);const I=t(()=>m.getComponentCode("stats-supervisors-sql.vue")),H=t(()=>m.getComponentCode("stats-supervisors-html.vue")),v=t(()=>m.getComponentCode("stats-supervisors-js.vue")),_=t(()=>{if(h.isInErrorComponents("stats-supervisors.vue")){const i=h.getVariableValue("stats-supervisors.vue","sql")||I.value;return m.updateComponentCode("stats-supervisors-sql.vue",i),i}return I.value}),f=t(()=>{if(h.isInErrorComponents("stats-supervisors.vue")){const i=h.getVariableValue("stats-supervisors.vue","html")||H.value;return m.updateComponentCode("stats-supervisors-html.vue",i),i}return H.value}),y=t(()=>{if(h.isInErrorComponents("stats-supervisors.vue")){const i=h.getVariableValue("stats-supervisors.vue","js")||v.value;return m.updateComponentCode("stats-supervisors-js.vue",i),i}return v.value}),o=d(""),s=d(""),a=t(()=>{var q,e;const i=(q=T.system)==null?void 0:q.db.query(_.value).results;return console.log("SQL Query:",_.value),((e=i==null?void 0:i[0])==null?void 0:e.count)||0}),b=t(()=>f.value.replace("{{ supervisorsCount }}",String(a.value)).replace("{{ label }}",c("supervisors")));function r(){o.value=_.value,s.value=f.value,C("openModal",{componentId:"stats-supervisors",htmlTemplate:s.value,sqlQuery:o.value})}function n(){if(p.isHighlightMode)return;new Function("selectedTableStore","navigateTo","systemId",y.value)(g,U,S.selectedId)}return(i,q)=>{const e=G;return E(),Q("div",null,[u("div",fe,[u("div",{id:"stats-supervisors",onClick:n,class:"cursor-pointer",innerHTML:b.value},null,8,ye),M(p).isEditModeActive?(E(),j(e,{key:0,onOpen:r})):B("",!0)])])}}}),Se=R(be,[["__scopeId","data-v-3e4cfb0d"]]),Te={class:"stat-card-wrapper"},He=["innerHTML"],Me=O({__name:"stats-meals",props:{system:{}},emits:["openModal","applyChanges"],setup(k,{expose:w,emit:S}){const g=J(),p=z(),m=D();A();const c=N(),{t:T}=x(),C=k,I=S;d(!1);const H=d(""),v=d(""),_=t(()=>c.getComponentCode("stats-meals-sql.vue")),f=t(()=>c.getComponentCode("stats-meals-html.vue")),y=t(()=>c.getComponentCode("stats-meals-js.vue")),o=t(()=>{if(h.isInErrorComponents("stats-meals.vue")){const e=h.getVariableValue("stats-meals.vue","sql")||_.value;return c.updateComponentCode("stats-meals-sql.vue",e),e}return _.value}),s=t(()=>{if(h.isInErrorComponents("stats-meals.vue")){const e=h.getVariableValue("stats-meals.vue","html")||f.value;return c.updateComponentCode("stats-meals-html.vue",e),e}return f.value}),a=t(()=>{if(h.isInErrorComponents("stats-meals.vue")){const e=h.getVariableValue("stats-meals.vue","js")||y.value;return c.updateComponentCode("stats-meals-js.vue",e),e}return y.value}),b=t(()=>{var $,l;const e=($=C.system)==null?void 0:$.db.query(o.value).results;return((l=e==null?void 0:e[0])==null?void 0:l.count)||0}),r=t(()=>s.value.replace("{{ mealsCount }}",String(b.value)).replace("{{ label }}",T("meals")));function n(){H.value=o.value,v.value=s.value,I("openModal",{componentId:"stats-meals",htmlTemplate:v.value,sqlQuery:H.value})}function i(e){H.value=e.sqlQuery,v.value=e.htmlTemplate}function q(){if(m.isHighlightMode)return;new Function("selectedTableStore","navigateTo","systemId",a.value)(p,U,g.selectedId)}return w({applyChanges:i}),(e,$)=>{const l=G;return E(),Q("div",null,[u("div",Te,[u("div",{id:"stats-meals",onClick:q,class:"cursor-pointer",innerHTML:r.value},null,8,He),M(m).isEditModeActive?(E(),j(l,{key:0,onOpen:n})):B("",!0)])])}}}),qe=R(Me,[["__scopeId","data-v-4999d61b"]]),Ee={class:"dashboard-header"},Ie={class:"dashboard-title"},we={class:"dashboard-subtitle"},ke={class:"stats"},$e=O({__name:"stats",props:{systemId:{}},setup(k){const w=J(),S=Y(),g=D(),{t:p}=x(),m=N(),c=k,T=d(),C=d(),I=d(),H=d(),v=d(!1),_=d(""),f=d(""),y=d(""),o=t(()=>{const r=c.systemId??w.selectedId;return S.systems.find(n=>n.id===r)});X(g.highlightHandler,g);function s(r){y.value=r.componentId,console.log("Opening editor for component:",y.value),_.value=r.htmlTemplate,f.value=r.sqlQuery,v.value=!0}function a(){const r=b(y.value);r&&r.applyChanges({htmlTemplate:_.value,sqlQuery:f.value}),v.value=!1}function b(r){switch(r){case"stats-sessions":return T.value;case"stats-participants":return C.value;case"stats-supervisors":return I.value;case"stats-meals":return H.value;default:return null}}return K(()=>{const r=D();console.log("HIGHLIGHT  ON:",r.isHighlightMode),console.log(r.highlightHandler.getHighlightedElements())}),(r,n)=>{var q;const i=ce;return E(),Q("div",null,[u("div",Ee,[u("h1",Ie,F(((q=o.value)==null?void 0:q.name)||"Dashboard"),1),u("p",we,F(M(p)("dashboard_subtitle")),1)]),u("div",ke,[V(ve,{ref_key:"statsSessionsRef",ref:T,id:"stats-sessions",class:"highlightable",onClick:n[0]||(n[0]=e=>M(g).isHighlightMode&&M(g).highlightHandler.selectElement("stats-sessions",e)),onOpenModal:s,system:o.value},null,8,["system"]),V(Ce,{ref_key:"statsParticipantsRef",ref:C,id:"stats-participants",class:"highlightable",onClick:n[1]||(n[1]=e=>M(g).isHighlightMode&&M(g).highlightHandler.selectElement("stats-participants",e)),onOpenModal:s,system:o.value},null,8,["system"]),V(Se,{ref_key:"statsSupervisorsRef",ref:I,id:"stats-supervisors",class:"highlightable",onClick:n[2]||(n[2]=e=>M(g).isHighlightMode&&M(g).highlightHandler.selectElement("stats-supervisors",e)),onOpenModal:s,system:o.value},null,8,["system"]),V(qe,{ref_key:"statsMealsRef",ref:H,id:"stats-meals",class:"highlightable",onClick:n[3]||(n[3]=e=>M(g).isHighlightMode&&M(g).highlightHandler.selectElement("stats-meals",e)),onOpenModal:s,system:o.value},null,8,["system"])]),(E(),j(se,{to:"body"},[v.value?(E(),j(i,{key:0,showEditor:v.value,draftHtmlTemplate:_.value,draftSqlQuery:f.value,draftJsCode:M(m).getComponentCode(y.value+"-js.vue"),componentId:y.value,"onUpdate:showEditor":n[4]||(n[4]=e=>v.value=e),"onUpdate:draftHtmlTemplate":n[5]||(n[5]=e=>_.value=e),"onUpdate:draftSqlQuery":n[6]||(n[6]=e=>f.value=e),onApplyChanges:a},null,8,["showEditor","draftHtmlTemplate","draftSqlQuery","draftJsCode","componentId"])):B("",!0)]))])}}}),Qe=R($e,[["__scopeId","data-v-04e82067"]]),Ve={key:0,class:"sessions-progress"},Fe={class:"progress-pillows"},De={class:"pillow-header"},Oe={class:"pillow-title"},Re={class:"pillow-count"},je={class:"pillow-bar-bg"},xe={class:"pillow-percent"},Be=O({__name:"dashboard-pillows",props:{sessionProgress:{}},setup(k){const w=k;return K(()=>{console.log("Dashboard Pillows component mounted with session progress:",w.sessionProgress)}),(S,g)=>S.sessionProgress.length?(E(),Q("div",Ve,[u("div",Fe,[(E(!0),Q(oe,null,ne(S.sessionProgress,p=>(E(),Q("div",{key:p.id,class:"progress-pillow"},[u("div",De,[u("span",Oe,F(p.name),1),u("span",Re,F(p.count)+"/"+F(p.capacity),1)]),u("div",je,[u("div",{class:"pillow-bar",style:ae({width:p.percent+"%",backgroundColor:p.color})},null,4)]),u("div",xe,F(p.percent)+"%",1)]))),128))])])):B("",!0)}}),Le=R(Be,[["__scopeId","data-v-4077c3b0"]]),Je={class:"dashboard-layout"},Ne={class:"dashboard-main"},Pe={class:"dashboard-content-row"},Ae={class:"dashboard-content-main"},Ue={id:"stats"},ze={class:"dashboard-section-title"},Ge=O({__name:"dashboard",setup(k){const w=Y(),S=D();re();const g=le(),{t:p}=x(),m=g.params.id,c=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899","#14B8A6","#F97316","#84CC16","#6366F1","#06B6D4","#64748B"],T=w.systems,C=d(null);d(null);const I=d(new Date);C.value=T.find(function(o){return o.id===parseInt(m,10)})||null;const H=t(function(){var o,s;return((s=(o=C.value)==null?void 0:o.tables.find(function(a){return a.name==="sessions"}))==null?void 0:s.data)||[]});t(function(){var o,s;return((s=(o=C.value)==null?void 0:o.tables.find(function(a){return a.name==="participants"}))==null?void 0:s.data)||[]}),t(function(){var o,s;return((s=(o=C.value)==null?void 0:o.tables.find(function(a){return a.name==="supervisors"}))==null?void 0:s.data)||[]}),t(function(){var o,s;return((s=(o=C.value)==null?void 0:o.tables.find(function(a){return a.name==="meals"}))==null?void 0:s.data)||[]}),t(function(){const o=new Map;return H.value.forEach(function(s,a){o.set(s.id,c[a%c.length])}),o});const v=t(()=>{var s;return(((s=C.value)==null?void 0:s.db.query("SELECT * FROM turnusy").results)||[]).map((a,b)=>{var i,q;const r=((q=(i=C.value)==null?void 0:i.db.query(`SELECT COUNT(*) as count FROM účastníci WHERE turnus_id = ${a.id}`).results[0])==null?void 0:q.count)||0,n=a.kapacita?Math.min(100,Math.round(r/a.kapacita*100)):0;return{id:a.id,name:`Turnus ${a.id}`,color:c[b%c.length],count:r,capacity:a.kapacita,percent:n}})}),_=t(function(){return I.value.getFullYear()}),f=t(function(){return I.value.getMonth()});t(function(){const o=_.value,s=f.value,a=new Date(o,s,1),b=new Date(a);b.setDate(b.getDate()-a.getDay());const r=[],n=new Date(b);for(let i=0;i<42;i++)r.push({date:new Date(n),isCurrentMonth:n.getMonth()===s,isToday:n.toDateString()===new Date().toDateString(),day:n.getDate()}),n.setDate(n.getDate()+1);return r}),X(S.highlightHandler,S);const y=d([{label:p("dashboard"),icon:"i-heroicons-chart-bar-20-solid",to:`/system/${m}/dashboard`,data_target:"system-dashboard"},{label:p("sessions"),icon:"i-heroicons-calendar-date-range",to:`/system/${m}/session`,data_target:"system-sessions"},{label:p("database"),icon:"i-heroicons-table-cells",to:`/system/${m}/database`,data_target:"system-table"}]);return(o,s)=>{var r;const a=ee,b=ue;return E(),Q("div",Je,[V(a,{items:y.value,class:""},null,8,["items"]),u("main",Ne,[u("div",Pe,[u("div",Ae,[u("div",Ue,[V(Qe,{"system-id":(r=C.value)==null?void 0:r.id},null,8,["system-id"])]),V(b,{style:{border:"2px solid","border-color":"#05df72"}},{default:ie(()=>[u("h1",ze,F(M(p)("dashboard_session_progress_title")),1),u("div",{id:"dashboard-pillows",class:"highlightable",onClick:s[0]||(s[0]=n=>M(S).isHighlightMode&&M(S).highlightHandler.selectElement("dashboard-pillows",n))},[V(Le,{sessionProgress:v.value},null,8,["sessionProgress"])])]),_:1})])])])])}}}),Xe=R(Ge,[["__scopeId","data-v-d55e5f46"]]);export{Xe as default};
