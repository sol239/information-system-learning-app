import{_ as se}from"./Djub6ojE.js";import{h as le,g as oe}from"./CHNo5zRk.js";import{f as te,x as ae,g as ne,C as b,m as h,ae as B,ac as ie,z as re,c as I,b as t,a as l,S as z,w as r,F as de,r as ue,t as i,h as c,i as me,o as E,d as _,j as ce,ag as ve,ah as pe,T as fe,_ as be}from"./j0WNL21o.js";import{_ as _e,a as ye}from"./DJVxr4fb.js";import{S as ge}from"./C5RhWAj9.js";import{S as xe}from"./B_2Y0efC.js";const he={class:"container mx-auto px-4 py-8"},Ve={class:"flex items-center gap-4 mb-6"},Se={class:"ml-auto"},$e={class:"text-lg font-semibold"},ke={class:"flex flex-col gap-3 pt-4"},we={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},Ie={class:"supervisor-header"},Ee={class:"flex items-center justify-between mb-4"},Ue={class:"text-xl font-semibold text-gray-900"},De={class:"flex items-center gap-2 text-base font-semibold text-gray-700"},Ce={class:"turnus-section mb-4"},Te={class:"text-sm text-gray-600"},Oe={class:"contact-section mb-6 space-y-2"},Re={class:"flex items-center gap-2 text-sm font-semibold text-gray-700"},je={class:"flex items-center gap-2 text-sm font-semibold text-gray-700"},Le={class:"supervisor-actions mt-6 pt-4 border-t border-gray-200"},Me={class:"flex gap-2"},Ne={class:"ml-auto"},Fe={class:"text-lg font-semibold"},qe={class:"flex flex-col gap-3 pt-4"},Be={key:0,class:"flex justify-center items-center gap-4 mt-8"},Pe={class:"flex items-center gap-2"},Ae={class:"text-sm text-gray-600"},ze={class:"text-xs text-gray-500"},Ze={key:1,class:"empty-state"},Je={class:"empty-title"},We={class:"empty-description"},Ye=te({__name:"supervisors",setup(He){const u=ae(),{t:a}=ne(),Z=b([{label:a("dashboard"),icon:"i-heroicons-chart-bar-20-solid",to:`/system/${u.selectedId}/dashboard`,data_target:"system-dashboard"},{label:a("sessions"),icon:"i-heroicons-calendar-date-range",to:`/system/${u.selectedId}/sessions`,data_target:"system-sessions"},{label:a("participants"),to:`/system/${u.selectedId}/participants`,data_target:"system-participants"},{label:a("supervisors"),to:`/system/${u.selectedId}/supervisors`,data_target:"system-supervisors"},{label:a("database"),icon:"i-heroicons-table-cells",to:`/system/${u.selectedId}/database`,data_target:"system-table"}]),w=b({label:a("all_sessions"),value:"all"}),L=b([]),U=b([]);b(!1);const d=b(null),V=b(!1),y=b(!1),D=b(!1),v=b({name:"",email:"",personal_number:"",phone:"",address:"",age:null,sessionId:null}),P=h(()=>U.value.map(s=>({label:`${a("session")} ${s.id} (${F(s.fromDate,s.toDate)})`,value:s.id}))),g=b(1),M=b(6),N=h(()=>Math.ceil(C.value.length/M.value)),J=h(()=>{const s=(g.value-1)*M.value,e=s+M.value;return C.value.slice(s,e)});B(()=>w.value.value,()=>{g.value=1});const W=h(()=>[{label:a("all_sessions"),value:"all"},...U.value.map(s=>({label:F(s.fromDate,s.toDate),value:s.id}))]),C=h(()=>w.value.value==="all"?L.value:L.value.filter(s=>s.sessionId===w.value.value)),x=ie();h(()=>null);const Y=h(()=>{var s,e,m,p,n;if(!((s=u.selectedSystem)!=null&&s.db))return"";try{const f=u.selectedSystem.db.query("SELECT COUNT(*) as count FROM vedoucí"),O=((m=(e=f==null?void 0:f.results)==null?void 0:e[0])==null?void 0:m.count)||0,$=u.selectedSystem.db.query("SELECT COUNT(*) as count FROM turnusy"),R=((n=(p=$==null?void 0:$.results)==null?void 0:p[0])==null?void 0:n.count)||0,k=u.selectedSystem.db.query("SELECT id, jméno, email FROM vedoucí ORDER BY id DESC LIMIT 3"),q=JSON.stringify((k==null?void 0:k.results)||[]);return`v${O}-s${R}-${q.length}-${Date.now()}`}catch{return`error-${Date.now()}`}});B(Y,(s,e)=>{e&&s!==e&&!s.startsWith("error")&&S()});const S=()=>{var s;if(!((s=u.selectedSystem)!=null&&s.db)){console.error("Database not available");return}try{const e=u.selectedSystem.db.query("SELECT * FROM vedoucí ORDER BY id").results||[],m=[];for(const n of e)m.push(new ge(n.id,n.jméno,n.email,n.rodné_číslo,n.telefon,n.adresa,n.věk,n.turnus_id));L.value=m;const p=u.selectedSystem.db.query("SELECT * FROM turnusy ORDER BY id");p.success&&(U.value=p.results.map(n=>new xe(n.id,new Date(n.od),new Date(n.do),n.kapacita,[])))}catch(e){console.error("Error loading data from database:",e)}};B(()=>u.selectedSystem,s=>{s&&S()},{immediate:!0});const H=s=>{const e=U.value.find(m=>m.id===s);return e?`${a("session")} ${e.id} (${F(e.fromDate,e.toDate)})`:a("unknown_session")},F=(s,e)=>{const m=s.toLocaleDateString("cs-CZ",{day:"numeric",month:"short"}),p=e.toLocaleDateString("cs-CZ",{day:"numeric",month:"short",year:"numeric"});return`${m} - ${p}`};async function Q(s){d.value={...s},y.value=!0}const A=()=>{T(),D.value=!0},G=async s=>{var e;if(!((e=u.selectedSystem)!=null&&e.db)){console.error("Database not available");return}V.value=!0;try{const m=typeof s.sessionId=="object"?s.sessionId.value:s.sessionId,p=`
            INSERT INTO vedoucí (jméno, email, rodné_číslo, telefon, adresa, věk, turnus_id)
            VALUES ('${s.name}', '${s.email}', '${s.personal_number}', '${s.phone}', '${s.address}', ${s.age}, ${m})
        `;if(u.selectedSystem.db.query(p).success)x.add({title:a("supervisor_added_success",{name:s.name}),color:"primary",icon:"i-heroicons-check"}),T(),S();else throw new Error("Database insert failed")}catch(m){console.error("Error adding supervisor:",m),x.add({title:a("supervisor_add_error"),color:"red",icon:"i-heroicons-exclamation-triangle"})}finally{V.value=!1}},T=()=>{v.value={name:"",email:"",personal_number:"",phone:"",address:"",age:null,sessionId:null},D.value=!1,y.value=!1},K=async s=>{var e;if(!((e=u.selectedSystem)!=null&&e.db)||!d.value){console.error("Database not available or no supervisor selected");return}V.value=!0;try{const m=typeof s.sessionId=="object"?s.sessionId.value:s.sessionId,p=`
            UPDATE vedoucí 
            SET jméno = '${s.name}', email = '${s.email}', rodné_číslo = '${s.personal_number}', 
                telefon = '${s.phone}', adresa = '${s.address}', věk = ${s.age}, turnus_id = ${m}
            WHERE id = '${d.value.id}'
        `;u.selectedSystem.db.query(p).success?(x.add({title:a("supervisor_updated_success",{name:s.name}),color:"primary",icon:"i-heroicons-check"}),S(),y.value=!1):(x.add({title:a("supervisor_update_error"),color:"red",icon:"i-heroicons-exclamation-triangle"}),y.value=!1)}catch{x.add({title:a("supervisor_update_error"),color:"red",icon:"i-heroicons-exclamation-triangle"}),y.value=!1}finally{V.value=!1}},X=s=>{var e;try{(e=u.selectedSystem)==null||e.db.query(`DELETE FROM vedoucí WHERE id = ${s.id}`),S(),x.add({title:a("supervisor_deleted_success",{name:s.name}),color:"primary",icon:"i-lucide-trash-2"})}catch{x.add({title:a("supervisor_delete_error",{name:s.name}),color:"red",icon:"i-lucide-alert-triangle"})}};return re(()=>{S()}),(s,e)=>{const m=se,p=le,n=me,f=ve,O=ye,$=oe,R=ce,k=_e,q=pe,j=fe;return E(),I("div",null,[t(m,{items:Z.value},null,8,["items"]),l("div",he,[l("div",Ve,[t(p,{modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=o=>w.value=o),items:W.value},null,8,["modelValue","items"]),l("div",Se,[t(k,{open:D.value,"onUpdate:open":e[9]||(e[9]=o=>D.value=o),direction:"right"},{content:r(()=>[t(R,{class:"p-4 min-w-96"},{header:r(()=>[l("h3",$e,i(c(a)("add_supervisor")),1)]),default:r(()=>[t($,{state:v.value,onSubmit:e[8]||(e[8]=o=>G(v.value)),class:"flex flex-col space-y-4"},{default:r(()=>[l("div",null,[e[21]||(e[21]=l("label",{for:"name",class:"block text-sm font-medium text-white mb-1"},"Jméno",-1)),t(f,{color:"violet",id:"name",modelValue:v.value.name,"onUpdate:modelValue":e[1]||(e[1]=o=>v.value.name=o),placeholder:"Zadejte jméno vedoucího"},null,8,["modelValue"])]),l("div",null,[e[22]||(e[22]=l("label",{for:"email",class:"block text-sm font-medium text-white mb-1"},"E-mail",-1)),t(f,{color:"violet",id:"email",modelValue:v.value.email,"onUpdate:modelValue":e[2]||(e[2]=o=>v.value.email=o),type:"email",placeholder:"email@example.com"},null,8,["modelValue"])]),l("div",null,[e[23]||(e[23]=l("label",{for:"personal_number",class:"block text-sm font-medium text-white mb-1"},"Rodné číslo",-1)),t(f,{color:"violet",id:"personal_number",modelValue:v.value.personal_number,"onUpdate:modelValue":e[3]||(e[3]=o=>v.value.personal_number=o),placeholder:"123456/7890"},null,8,["modelValue"])]),l("div",null,[e[24]||(e[24]=l("label",{for:"phone",class:"block text-sm font-medium text-white mb-1"},"Telefon",-1)),t(f,{color:"violet",id:"phone",modelValue:v.value.phone,"onUpdate:modelValue":e[4]||(e[4]=o=>v.value.phone=o),placeholder:"+420 123 456 789"},null,8,["modelValue"])]),l("div",null,[e[25]||(e[25]=l("label",{for:"address",class:"block text-sm font-medium text-white mb-1"},"Adresa",-1)),t(O,{color:"violet",id:"address",modelValue:v.value.address,"onUpdate:modelValue":e[5]||(e[5]=o=>v.value.address=o),placeholder:"Ulice číslo, město, PSČ",rows:2},null,8,["modelValue"])]),l("div",null,[e[26]||(e[26]=l("label",{for:"age",class:"block text-sm font-medium text-white mb-1"},"Věk",-1)),t(f,{color:"violet",id:"age",modelValue:v.value.age,"onUpdate:modelValue":e[6]||(e[6]=o=>v.value.age=o),type:"number",min:"18",max:"100",placeholder:"18"},null,8,["modelValue"])]),l("div",null,[e[27]||(e[27]=l("label",{for:"sessionId",class:"block text-sm font-medium text-white mb-1"},"Turnus",-1)),t(p,{id:"sessionId",color:"violet",modelValue:v.value.sessionId,"onUpdate:modelValue":e[7]||(e[7]=o=>v.value.sessionId=o),items:P.value,placeholder:"Vyberte turnus"},null,8,["modelValue","items"])]),l("div",ke,[t(n,{type:"submit",color:"violet",loading:V.value},{default:r(()=>[_(i(c(a)("add")),1)]),_:1},8,["loading"]),t(n,{variant:"outline",color:"violet",onClick:T},{default:r(()=>[_(i(c(a)("cancel")),1)]),_:1})])]),_:1},8,["state"])]),_:1})]),default:r(()=>[t(n,{color:"violet",variant:"outline",onClick:A,icon:"i-heroicons-plus"},{default:r(()=>[_(i(c(a)("add_supervisor")),1)]),_:1})]),_:1},8,["open"])])]),l("div",we,[(E(!0),I(de,null,ue(J.value,o=>(E(),I("div",{key:o.id,class:"supervisor-card"},[l("div",Ie,[l("div",Ee,[l("h3",Ue,i(o.name),1),t(q,{color:"violet",size:"lg",variant:"soft"},{default:r(()=>[_(i(c(a)("age"))+": "+i(o.age),1)]),_:2},1024)]),l("div",De,[t(j,{name:"i-heroicons-envelope",class:"w-4 h-4"}),l("span",null,i(o.email),1)])]),l("div",Ce,[l("span",Te,i(H(o.sessionId)),1)]),l("div",Oe,[l("div",Re,[t(j,{name:"i-heroicons-phone",class:"w-4 h-4"}),l("span",null,i(o.phone),1)]),l("div",je,[t(j,{name:"i-heroicons-map-pin",class:"w-4 h-4"}),l("span",null,i(o.address),1)])]),l("div",Le,[l("div",Me,[l("div",Ne,[t(n,{size:"sm",color:"violet",variant:"solid",onClick:ee=>Q(o),class:"flex-1"},{default:r(()=>[_(i(c(a)("view_details")),1)]),_:2},1032,["onClick"])]),t(n,{size:"sm",color:"red",variant:"outline",onClick:ee=>X(o)},{default:r(()=>[_(i(c(a)("delete")),1)]),_:2},1032,["onClick"])])])]))),128))]),t(k,{class:"ml-auto",open:y.value,"onUpdate:open":e[18]||(e[18]=o=>y.value=o),direction:"right"},{content:r(()=>[t(R,{class:"p-4 min-w-96"},{header:r(()=>[l("h3",Fe,i(c(a)("supervisor_details")),1)]),default:r(()=>[t($,{state:d.value,onSubmit:e[17]||(e[17]=o=>K(d.value)),class:"flex flex-col space-y-4"},{default:r(()=>[l("div",null,[e[28]||(e[28]=l("label",{for:"edit-name",class:"block text-sm font-medium text-white mb-1"},"Jméno",-1)),t(f,{color:"violet",id:"edit-name",modelValue:d.value.name,"onUpdate:modelValue":e[10]||(e[10]=o=>d.value.name=o),placeholder:"Zadejte jméno vedoucího"},null,8,["modelValue"])]),l("div",null,[e[29]||(e[29]=l("label",{for:"edit-email",class:"block text-sm font-medium text-white mb-1"},"E-mail",-1)),t(f,{color:"violet",id:"edit-email",modelValue:d.value.email,"onUpdate:modelValue":e[11]||(e[11]=o=>d.value.email=o),type:"email",placeholder:"email@example.com"},null,8,["modelValue"])]),l("div",null,[e[30]||(e[30]=l("label",{for:"edit-personal_number",class:"block text-sm font-medium text-white mb-1"},"Rodné číslo",-1)),t(f,{color:"violet",id:"edit-personal_number",modelValue:d.value.personal_number,"onUpdate:modelValue":e[12]||(e[12]=o=>d.value.personal_number=o),placeholder:"123456/7890"},null,8,["modelValue"])]),l("div",null,[e[31]||(e[31]=l("label",{for:"edit-phone",class:"block text-sm font-medium text-white mb-1"},"Telefon",-1)),t(f,{color:"violet",id:"edit-phone",modelValue:d.value.phone,"onUpdate:modelValue":e[13]||(e[13]=o=>d.value.phone=o),placeholder:"+420 123 456 789"},null,8,["modelValue"])]),l("div",null,[e[32]||(e[32]=l("label",{for:"edit-address",class:"block text-sm font-medium text-white mb-1"},"Adresa",-1)),t(O,{color:"violet",id:"edit-address",modelValue:d.value.address,"onUpdate:modelValue":e[14]||(e[14]=o=>d.value.address=o),placeholder:"Ulice číslo, město, PSČ",rows:2},null,8,["modelValue"])]),l("div",null,[e[33]||(e[33]=l("label",{for:"edit-age",class:"block text-sm font-medium text-white mb-1"},"Věk",-1)),t(f,{color:"violet",id:"edit-age",modelValue:d.value.age,"onUpdate:modelValue":e[15]||(e[15]=o=>d.value.age=o),type:"number",min:"18",max:"100",placeholder:"18"},null,8,["modelValue"])]),l("div",null,[e[34]||(e[34]=l("label",{for:"edit-sessionId",class:"block text-sm font-medium text-white mb-1"},"Turnus",-1)),t(p,{color:"violet",id:"edit-sessionId",modelValue:d.value.sessionId,"onUpdate:modelValue":e[16]||(e[16]=o=>d.value.sessionId=o),items:P.value,placeholder:"Vyberte turnus"},null,8,["modelValue","items"])]),l("div",qe,[t(n,{type:"submit",color:"violet",loading:V.value},{default:r(()=>[_(i(c(a)("save_changes")),1)]),_:1},8,["loading"]),t(n,{variant:"outline",color:"violet",onClick:T},{default:r(()=>[_(i(c(a)("cancel")),1)]),_:1})])]),_:1},8,["state"])]),_:1})]),_:1},8,["open"]),N.value>1?(E(),I("div",Be,[t(n,{variant:"outline",color:"violet",icon:"i-heroicons-chevron-left",disabled:g.value===1,onClick:e[19]||(e[19]=o=>g.value--)},{default:r(()=>[_(i(c(a)("previous")),1)]),_:1},8,["disabled"]),l("div",Pe,[l("span",Ae,i(c(a)("page"))+" "+i(g.value)+" "+i(c(a)("of"))+" "+i(N.value),1),l("span",ze," ("+i(C.value.length)+" "+i(c(a)("supervisors"))+") ",1)]),t(n,{variant:"outline",color:"violet",icon:"i-heroicons-chevron-right",disabled:g.value===N.value,onClick:e[20]||(e[20]=o=>g.value++)},{default:r(()=>[_(i(c(a)("next")),1)]),_:1},8,["disabled"])])):z("",!0),C.value.length===0?(E(),I("div",Ze,[t(j,{name:"i-heroicons-user-x-mark",class:"empty-icon"}),l("h3",Je,i(c(a)("no_supervisors")),1),l("p",We,i(c(a)("no_supervisors_description")),1),t(n,{onClick:A,class:"mt-4"},{default:r(()=>[_(i(c(a)("create_supervisor")),1)]),_:1})])):z("",!0)])])}}}),ls=be(Ye,[["__scopeId","data-v-7495eb16"]]);export{ls as default};
