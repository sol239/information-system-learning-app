import{_ as ee}from"./Djub6ojE.js";import{f as B,x as P,ab as D,a_ as U,al as A,g as R,C as c,m as t,c as Q,a as d,A as J,S as x,h as T,n as z,o as w,am as g,a$ as te,_ as j,v as Y,z as K,t as O,b as F,aO as se,F as oe,r as ne,az as ae,b0 as re,b1 as le,B as ie,w as ue,j as ce}from"./j0WNL21o.js";import{u as G,a as W,_ as de}from"./DbKoplje.js";import{u as X}from"./CEer_hvB.js";const pe={class:"stat-card-wrapper"},me=["innerHTML"],ve=B({__name:"stats-sessions",props:{system:{}},emits:["openModal","applyChanges"],setup(H,{expose:q,emit:$}){const m=P(),v=G(),i=D(),n=U(),_=A(),{t:f}=R(),k=H,M=$;c(!1);const h=c(""),C=c("");function y(u){return te.getNotCompletedTasks(n.currentRound).some(N=>Array.isArray(N.errorComponents)&&N.errorComponents.some(Z=>Z.name===u))}const b=t(()=>_.getComponentCode("stats-sessions-sql.vue")),s=t(()=>_.getComponentCode("stats-sessions-html.vue")),o=t(()=>_.getComponentCode("stats-sessions-js.vue")),r=t(()=>{if(y("stats-sessions.vue")){const u=g.getVariableValue("stats-sessions.vue","sql")||b.value;return _.updateComponentCode("stats-sessions-sql.vue",u),u}return b.value}),S=t(()=>{if(y("stats-sessions.vue")){const u=g.getVariableValue("stats-sessions.vue","html")||s.value;return _.updateComponentCode("stats-sessions-html.vue",u),u}return s.value}),l=t(()=>{if(g.isInErrorComponents("stats-sessions.vue")){const u=g.getVariableValue("stats-sessions.vue","js")||o.value;return _.updateComponentCode("stats-sessions-js.vue",u),u}return o.value}),a=t(()=>{var V,L,N;return((N=(L=(V=k.system)==null?void 0:V.db.query(r.value).results)==null?void 0:L[0])==null?void 0:N.count)||0}),p=t(()=>S.value.replace("{{ sessionsCount }}",String(a.value)).replace("{{ label }}",f("sessions")));function E(){h.value=r.value,C.value=S.value,M("openModal",{componentId:"stats-sessions",htmlTemplate:C.value,sqlQuery:h.value})}function e(u){h.value=u.sqlQuery,C.value=u.htmlTemplate}function I(){if(i.isHighlightMode)return;new Function("selectedTableStore","navigateTo","systemId",l.value)(v,z,m.selectedId)}return q({applyChanges:e}),(u,V)=>{const L=W;return w(),Q("div",null,[d("div",pe,[d("div",{id:"stats-sessions",onClick:I,class:"cursor-pointer",innerHTML:p.value},null,8,me),T(i).isEditModeActive?(w(),J(L,{key:0,onOpen:E})):x("",!0)])])}}}),he=j(ve,[["__scopeId","data-v-19333b49"]]),ge={class:"stat-card-wrapper"},_e=["innerHTML"],fe=B({__name:"stats-participants",props:{system:{}},emits:["openModal","applyChanges"],setup(H,{expose:q,emit:$}){const m=P(),v=G(),i=D();U();const n=A(),{t:_}=R(),f=H,k=$;c(!1);const M=c(""),h=c(""),C=t(()=>n.getComponentCode("stats-participants-sql.vue")),y=t(()=>n.getComponentCode("stats-participants-html.vue")),b=t(()=>n.getComponentCode("stats-participants-js.vue")),s=t(()=>{if(g.isInErrorComponents("stats-participants.vue")){const e=g.getVariableValue("stats-participants.vue","sql")||C.value;return n.updateComponentCode("stats-participants-sql.vue",e),e}return C.value}),o=t(()=>{if(g.isInErrorComponents("stats-participants.vue")){const e=g.getVariableValue("stats-participants.vue","html")||y.value;return n.updateComponentCode("stats-participants-html.vue",e),e}return y.value}),r=t(()=>{if(g.isInErrorComponents("stats-participants.vue")){const e=g.getVariableValue("stats-participants.vue","js")||b.value;return n.updateComponentCode("stats-participants-js.vue",e),e}return b.value}),S=t(()=>{var I,u,V;return((V=(u=(I=f.system)==null?void 0:I.db.query(s.value).results)==null?void 0:u[0])==null?void 0:V.count)||0}),l=t(()=>o.value.replace("{{ participantsCount }}",String(S.value)).replace("{{ label }}",_("participants")));function a(){M.value=s.value,h.value=o.value,k("openModal",{componentId:"stats-participants",htmlTemplate:h.value,sqlQuery:M.value})}function p(e){M.value=e.sqlQuery,h.value=e.htmlTemplate}function E(){if(i.isHighlightMode)return;new Function("selectedTableStore","navigateTo","systemId",r.value)(v,z,m.selectedId)}return q({applyChanges:p}),(e,I)=>{const u=W;return w(),Q("div",null,[d("div",ge,[d("div",{id:"stats-participants",onClick:E,class:"cursor-pointer",innerHTML:l.value},null,8,_e),T(i).isEditModeActive?(w(),J(u,{key:0,onOpen:a})):x("",!0)])])}}}),Ce=j(fe,[["__scopeId","data-v-c0f7f3db"]]),ye={class:"stat-card-wrapper"},be=["innerHTML"],Se=B({__name:"stats-supervisors",props:{system:{}},emits:["openModal","applyChanges"],setup(H,{emit:q}){const $=P(),m=G(),v=D();U();const i=A(),{t:n}=R(),_=H,f=q;c(!1);const k=t(()=>i.getComponentCode("stats-supervisors-sql.vue")),M=t(()=>i.getComponentCode("stats-supervisors-html.vue")),h=t(()=>i.getComponentCode("stats-supervisors-js.vue")),C=t(()=>{if(g.isInErrorComponents("stats-supervisors.vue")){const p=g.getVariableValue("stats-supervisors.vue","sql")||k.value;return i.updateComponentCode("stats-supervisors-sql.vue",p),p}return k.value}),y=t(()=>{if(g.isInErrorComponents("stats-supervisors.vue")){const p=g.getVariableValue("stats-supervisors.vue","html")||M.value;return i.updateComponentCode("stats-supervisors-html.vue",p),p}return M.value}),b=t(()=>{if(g.isInErrorComponents("stats-supervisors.vue")){const p=g.getVariableValue("stats-supervisors.vue","js")||h.value;return i.updateComponentCode("stats-supervisors-js.vue",p),p}return h.value}),s=c(""),o=c(""),r=t(()=>{var E,e,I;return((I=(e=(E=_.system)==null?void 0:E.db.query(C.value).results)==null?void 0:e[0])==null?void 0:I.count)||0}),S=t(()=>y.value.replace("{{ supervisorsCount }}",String(r.value)).replace("{{ label }}",n("supervisors")));function l(){s.value=C.value,o.value=y.value,f("openModal",{componentId:"stats-supervisors",htmlTemplate:o.value,sqlQuery:s.value})}function a(){if(v.isHighlightMode)return;new Function("selectedTableStore","navigateTo","systemId",b.value)(m,z,$.selectedId)}return(p,E)=>{const e=W;return w(),Q("div",null,[d("div",ye,[d("div",{id:"stats-supervisors",onClick:a,class:"cursor-pointer",innerHTML:S.value},null,8,be),T(v).isEditModeActive?(w(),J(e,{key:0,onOpen:l})):x("",!0)])])}}}),Te=j(Se,[["__scopeId","data-v-b2db0eb4"]]),Me={class:"stat-card-wrapper"},He=["innerHTML"],qe=B({__name:"stats-meals",props:{system:{}},emits:["openModal","applyChanges"],setup(H,{expose:q,emit:$}){const m=P(),v=G(),i=D();U();const n=A(),{t:_}=R(),f=H,k=$;c(!1);const M=c(""),h=c(""),C=t(()=>n.getComponentCode("stats-meals-sql.vue")),y=t(()=>n.getComponentCode("stats-meals-html.vue")),b=t(()=>n.getComponentCode("stats-meals-js.vue")),s=t(()=>{if(g.isInErrorComponents("stats-meals.vue")){const e=g.getVariableValue("stats-meals.vue","sql")||C.value;return n.updateComponentCode("stats-meals-sql.vue",e),e}return C.value}),o=t(()=>{if(g.isInErrorComponents("stats-meals.vue")){const e=g.getVariableValue("stats-meals.vue","html")||y.value;return n.updateComponentCode("stats-meals-html.vue",e),e}return y.value}),r=t(()=>{if(g.isInErrorComponents("stats-meals.vue")){const e=g.getVariableValue("stats-meals.vue","js")||b.value;return n.updateComponentCode("stats-meals-js.vue",e),e}return b.value}),S=t(()=>{var I,u,V;return((V=(u=(I=f.system)==null?void 0:I.db.query(s.value).results)==null?void 0:u[0])==null?void 0:V.count)||0}),l=t(()=>o.value.replace("{{ mealsCount }}",String(S.value)).replace("{{ label }}",_("meals")));function a(){M.value=s.value,h.value=o.value,k("openModal",{componentId:"stats-meals",htmlTemplate:h.value,sqlQuery:M.value})}function p(e){M.value=e.sqlQuery,h.value=e.htmlTemplate}function E(){if(i.isHighlightMode)return;new Function("selectedTableStore","navigateTo","systemId",r.value)(v,z,m.selectedId)}return q({applyChanges:p}),(e,I)=>{const u=W;return w(),Q("div",null,[d("div",Me,[d("div",{id:"stats-meals",onClick:E,class:"cursor-pointer",innerHTML:l.value},null,8,He),T(i).isEditModeActive?(w(),J(u,{key:0,onOpen:a})):x("",!0)])])}}}),Ee=j(qe,[["__scopeId","data-v-75601456"]]),Ie={class:"dashboard-header"},we={class:"dashboard-title"},$e={class:"dashboard-subtitle"},ke={class:"stats"},Ve=B({__name:"stats",props:{systemId:{}},setup(H){const q=P(),$=Y(),m=D(),{t:v}=R(),i=A(),n=H,_=c(),f=c(),k=c(),M=c(),h=c(!1),C=c(""),y=c(""),b=c(""),s=t(()=>{const l=n.systemId??q.selectedId;return $.systems.find(a=>a.id===l)});X(m.highlightHandler,m);function o(l){b.value=l.componentId,console.log("Opening editor for component:",b.value),C.value=l.htmlTemplate,y.value=l.sqlQuery,h.value=!0}function r(){const l=S(b.value);l&&l.applyChanges({htmlTemplate:C.value,sqlQuery:y.value}),h.value=!1}function S(l){switch(l){case"stats-sessions":return _.value;case"stats-participants":return f.value;case"stats-supervisors":return k.value;case"stats-meals":return M.value;default:return null}}return K(()=>{const l=D();console.log("HIGHLIGHT  ON:",l.isHighlightMode),console.log(l.highlightHandler.getHighlightedElements())}),(l,a)=>{var E;const p=de;return w(),Q("div",null,[d("div",Ie,[d("h1",we,O(((E=s.value)==null?void 0:E.name)||"Dashboard"),1),d("p",$e,O(T(v)("dashboard_subtitle")),1)]),d("div",ke,[F(he,{ref_key:"statsSessionsRef",ref:_,id:"stats-sessions",class:"highlightable",onClick:a[0]||(a[0]=e=>T(m).isHighlightMode&&T(m).highlightHandler.selectElement("stats-sessions",e)),onOpenModal:o,system:s.value},null,8,["system"]),F(Ce,{ref_key:"statsParticipantsRef",ref:f,id:"stats-participants",class:"highlightable",onClick:a[1]||(a[1]=e=>T(m).isHighlightMode&&T(m).highlightHandler.selectElement("stats-participants",e)),onOpenModal:o,system:s.value},null,8,["system"]),F(Te,{ref_key:"statsSupervisorsRef",ref:k,id:"stats-supervisors",class:"highlightable",onClick:a[2]||(a[2]=e=>T(m).isHighlightMode&&T(m).highlightHandler.selectElement("stats-supervisors",e)),onOpenModal:o,system:s.value},null,8,["system"]),F(Ee,{ref_key:"statsMealsRef",ref:M,id:"stats-meals",class:"highlightable",onClick:a[3]||(a[3]=e=>T(m).isHighlightMode&&T(m).highlightHandler.selectElement("stats-meals",e)),onOpenModal:o,system:s.value},null,8,["system"])]),(w(),J(se,{to:"body"},[h.value?(w(),J(p,{key:0,showEditor:h.value,draftHtmlTemplate:C.value,draftSqlQuery:y.value,draftJsCode:T(i).getComponentCode(b.value+"-js.vue"),componentId:b.value,"onUpdate:showEditor":a[4]||(a[4]=e=>h.value=e),"onUpdate:draftHtmlTemplate":a[5]||(a[5]=e=>C.value=e),"onUpdate:draftSqlQuery":a[6]||(a[6]=e=>y.value=e),onApplyChanges:r},null,8,["showEditor","draftHtmlTemplate","draftSqlQuery","draftJsCode","componentId"])):x("",!0)]))])}}}),Qe=j(Ve,[["__scopeId","data-v-de493761"]]),Fe={key:0,class:"sessions-progress"},De={class:"progress-pillows"},Oe=["id","onClick","system"],Be={class:"pillow-header"},je={class:"pillow-title"},Je={class:"pillow-count"},Pe={class:"pillow-bar-bg"},Re={class:"pillow-percent"},xe=B({__name:"dashboard-pillows",props:{sessionProgress:{}},setup(H){const q=D(),$=P(),m=H;return K(()=>{console.log("Dashboard Pillows component mounted with session progress:",m.sessionProgress)}),(v,i)=>v.sessionProgress.length?(w(),Q("div",Fe,[d("div",De,[(w(!0),Q(oe,null,ne(v.sessionProgress,n=>(w(),Q("div",{key:n.id,class:"progress-pillow highlightable",id:"stats-pillow-"+n.id,onClick:_=>T(q).isHighlightMode&&T(q).highlightHandler.selectElement("stats-pillow-"+n.id,_),"on:openModal":i[0]||(i[0]=(..._)=>v.handleOpenModal&&v.handleOpenModal(..._)),system:T($).selectedSystem},[d("div",Be,[d("span",je,O(n.name),1),d("span",Je,O(n.count)+"/"+O(n.capacity),1)]),d("div",Pe,[d("div",{class:"pillow-bar",style:ae({width:n.percent+"%",backgroundColor:n.color})},null,4)]),d("div",Re,O(n.percent)+"%",1)],40,Oe))),128))])])):x("",!0)}}),Le=j(xe,[["__scopeId","data-v-40fa66aa"]]),Ne=re("persistentStorageTest",()=>{const H=c(0);function q(){console.log("Current counter: ",H.value),H.value++}return{counter:H,incrementCounter:q}},{persist:!0}),Ae={class:"dashboard-layout"},Ue={class:"dashboard-main"},ze={class:"dashboard-content-row"},Ge={class:"dashboard-content-main"},We={id:"stats"},Ye={class:"dashboard-section-title"},Ke={id:"dashboard-pillows"},Xe=B({__name:"dashboard",setup(H){const q=Y(),$=D();le(),Ne();const m=ie(),{t:v}=R(),i=m.params.id,n=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899","#14B8A6","#F97316","#84CC16","#6366F1","#06B6D4","#64748B"],_=q.systems,f=c(null);c(null);const k=c(new Date);f.value=_.find(function(s){return s.id===parseInt(i,10)})||null;const M=t(function(){var s,o;return((o=(s=f.value)==null?void 0:s.tables.find(function(r){return r.name==="sessions"}))==null?void 0:o.data)||[]});t(function(){var s,o;return((o=(s=f.value)==null?void 0:s.tables.find(function(r){return r.name==="participants"}))==null?void 0:o.data)||[]}),t(function(){var s,o;return((o=(s=f.value)==null?void 0:s.tables.find(function(r){return r.name==="supervisors"}))==null?void 0:o.data)||[]}),t(function(){var s,o;return((o=(s=f.value)==null?void 0:s.tables.find(function(r){return r.name==="meals"}))==null?void 0:o.data)||[]}),t(function(){const s=new Map;return M.value.forEach(function(o,r){s.set(o.id,n[r%n.length])}),s});const h=t(()=>{var s;if(!((s=f.value)!=null&&s.db)||typeof f.value.db.query!="function")return[];try{return(f.value.db.query("SELECT * FROM turnusy").results||[]).map((r,S)=>{var E,e,I;const l=(E=f.value)==null?void 0:E.db.query(`SELECT COUNT(*) as count FROM účastníci WHERE turnus_id = ${r.id}`),a=((I=(e=l==null?void 0:l.results)==null?void 0:e[0])==null?void 0:I.count)||0,p=r.kapacita?Math.min(100,Math.round(a/r.kapacita*100)):0;return{id:r.id,name:`Turnus ${r.id}`,color:n[S%n.length],count:a,capacity:r.kapacita,percent:p}})}catch(o){return console.warn("Database query failed in sessionProgress:",o),[]}}),C=t(function(){return k.value.getFullYear()}),y=t(function(){return k.value.getMonth()});t(function(){const s=C.value,o=y.value,r=new Date(s,o,1),S=new Date(r);S.setDate(S.getDate()-r.getDay());const l=[],a=new Date(S);for(let p=0;p<42;p++)l.push({date:new Date(a),isCurrentMonth:a.getMonth()===o,isToday:a.toDateString()===new Date().toDateString(),day:a.getDate()}),a.setDate(a.getDate()+1);return l}),X($.highlightHandler,$);const b=c([{label:v("dashboard"),icon:"i-heroicons-chart-bar-20-solid",to:`/system/${i}/dashboard`,data_target:"system-dashboard"},{label:v("sessions"),icon:"i-heroicons-calendar-date-range",to:`/system/${i}/sessions`,data_target:"system-sessions"},{label:v("participants"),to:`/system/${i}/participants`,data_target:"system-participants"},{label:v("supervisors"),to:`/system/${i}/supervisors`,data_target:"system-supervisors"},{label:v("database"),icon:"i-heroicons-table-cells",to:`/system/${i}/database`,data_target:"system-table"}]);return(s,o)=>{var l;const r=ee,S=ce;return w(),Q("div",Ae,[F(r,{items:b.value,class:""},null,8,["items"]),d("main",Ue,[d("div",ze,[d("div",Ge,[d("div",We,[F(Qe,{"system-id":(l=f.value)==null?void 0:l.id},null,8,["system-id"])]),F(S,{style:{border:"2px solid","border-color":"#05df72"}},{default:ue(()=>[d("h1",Ye,O(T(v)("dashboard_session_progress_title")),1),d("div",Ke,[F(Le,{sessionProgress:h.value},null,8,["sessionProgress"])])]),_:1})])])])])}}}),ot=j(Xe,[["__scopeId","data-v-e34d2876"]]);export{ot as default};
